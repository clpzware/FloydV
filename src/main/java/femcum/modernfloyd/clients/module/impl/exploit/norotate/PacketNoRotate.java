package femcum.modernfloyd.clients.module.impl.exploit.norotate;

import femcum.modernfloyd.clients.event.Listener;
import femcum.modernfloyd.clients.event.annotations.EventLink;
import femcum.modernfloyd.clients.event.impl.other.TeleportEvent;
import femcum.modernfloyd.clients.event.impl.packet.PacketSendEvent;
import femcum.modernfloyd.clients.module.impl.exploit.NoRotate;
import femcum.modernfloyd.clients.value.Mode;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C03PacketPlayer;

public class PacketNoRotate extends Mode<NoRotate> {

    private float yaw, pitch;
    private boolean teleport;

    public PacketNoRotate(String name, NoRotate parent) {
        super(name, parent);
    }

    @EventLink
    public final Listener<TeleportEvent> onTeleport = event -> {
        this.yaw = event.getYaw();
        this.pitch = event.getPitch();

        event.setYaw(mc.thePlayer.rotationYaw);
        event.setPitch(mc.thePlayer.rotationPitch);

        this.teleport = true;
    };

    @EventLink
    public final Listener<PacketSendEvent> onPacketSend = event -> {
        final Packet packet = event.getPacket();

        if (this.teleport && packet instanceof C03PacketPlayer.C06PacketPlayerPosLook) {
            final C03PacketPlayer.C06PacketPlayerPosLook c06PacketPlayerPosLook = ((C03PacketPlayer.C06PacketPlayerPosLook) packet);

            c06PacketPlayerPosLook.yaw = this.yaw;
            c06PacketPlayerPosLook.pitch = this.pitch;

            event.setPacket(c06PacketPlayerPosLook);

            this.teleport = false;
        }
    };
}