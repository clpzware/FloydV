package femcum.modernfloyd.clients.module.impl.exploit.disabler;

import femcum.modernfloyd.clients.event.Listener;
import femcum.modernfloyd.clients.event.annotations.EventLink;
import femcum.modernfloyd.clients.event.impl.motion.PreMotionEvent;
import femcum.modernfloyd.clients.module.impl.exploit.Disabler;
import femcum.modernfloyd.clients.util.math.MathUtil;
import femcum.modernfloyd.clients.util.packet.PacketUtil;
import femcum.modernfloyd.clients.util.player.MoveUtil;
import femcum.modernfloyd.clients.value.Mode;
import femcum.modernfloyd.clients.value.impl.BooleanValue;
import femcum.modernfloyd.clients.value.impl.ModeValue;
import femcum.modernfloyd.clients.value.impl.NumberValue;
import femcum.modernfloyd.clients.value.impl.SubMode;
import net.minecraft.network.play.client.C03PacketPlayer;

public class TeleportDisabler extends Mode<Disabler> {

    private final ModeValue direction = new ModeValue("Direction", this)
            .add(new SubMode("Up"))
            .add(new SubMode("Down"))
            .add(new SubMode("Horizontal"))
            .setDefault("Up");

    private final NumberValue delay = new NumberValue("Delay", this, 20, 2, 100, 1);
    private final BooleanValue mathGround = new BooleanValue("Math Ground", this, false);
    private final BooleanValue groundState = new BooleanValue("Ground State", this, false);

    public TeleportDisabler(String name, Disabler parent) {
        super(name, parent);
    }

    @EventLink
    public final Listener<PreMotionEvent> onPreMotionEvent = event -> {
        if (mc.thePlayer.ticksExisted % delay.getValue().intValue() == 0) {
            double x = event.getPosX();
            double y = event.getPosY();
            double z = event.getPosZ();

            switch (direction.getValue().getName()) {
                case "Up": {
                    y += MathUtil.getRandom(1024, 2048);
                    break;
                }

                case "Down": {
                    y -= MathUtil.getRandom(1024, 2048);
                    break;
                }

                case "Horizontal": {
                    x += MathUtil.getRandom(1024, 2048);
                    z -= MathUtil.getRandom(1024, 2048);
                    break;
                }
            }

            if (mathGround.getValue()) {
                y = MoveUtil.roundToGround(y);
            }

            PacketUtil.send(new C03PacketPlayer.C04PacketPlayerPosition(x, y, z, groundState.getValue()));
        }
    };
}